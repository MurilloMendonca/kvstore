--[[
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡔⠋⠣⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⡏⠀⠀⢠⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠑⢢⣶⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⠔⠒⢦⣄⣀⣀⡴⠋⠁⠉⢧⠀⠀⠀⠀⠀⠀⠀⢀⡴⠦⣄⠀⠀⠀⠀⠀⣄⡴⠊⠓⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⡇⠀⠀⠀⠀⠀⠀⠉⠀⠀⠀⣀⡾⠀⠀⠀⣀⣤⠤⠖⠋⠀⠀⠀⠓⢦⡀⠀⢸⡆⠀⠀⠀⠈⢹⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡤⠖⠚⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⣟⠉⣀⡀⠀⣸⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠢⠎⠀⠀⠀⠀⠀⣾⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⢇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠉⠉⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣹⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣀⣸⠇⠀⠀⠀⠀⢀⣀⣠⡤⠤⠶⠶⠶⠶⠶⠤⢤⣀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡶⠶⣄⠀⠀⣠⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣰⠒⢲⡄⠀⠀⠀⢠⡞⠁⠀⠀⠀⠀⣠⠴⠚⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠙⠲⢤⣀⠀⠀⠀⠀⠀⠠⡟⠁⠀⠈⠙⠙⣁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣟⠀⢸⡇⠀⣦⠀⣴⠃⠀⠀⢀⡴⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⣿⣿⣿⣷⣦⡀⠀⠀⠉⠳⣄⡀⠀⠀⠀⠘⣆⠀⣀⣤⠞⠉⠑⢦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠈⠉⣿⠋⠙⠛⡞⠁⠀⢀⡼⠋⠀⣠⣤⣤⣀⡀⠀⠀⠀⠀⠀⣀⣸⣿⣿⣿⣿⣿⣿⣶⡄⠀⠀⠀⠈⠻⣄⠀⠀⠀⠀⠉⠁⠀⠀⠀⠀⠈⠳⢄⠀⠀⠀⢀⡖⠚⠷⡀
⠀⢠⡇⠀⠀⣰⠻⡄⣼⠟⠀⠀⢀⣿⣿⣿⣿⣿⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣤⡀⠀⠀⠈⢳⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢨⡇⠀⠀⢘⡆⢠⡴⠃
⢠⠏⠀⠀⢰⠃⠀⢻⡋⠀⣠⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣾⣧⠀⢳⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⠀⠀⢰⡎⠀⠘⠧⣄
⠈⠑⣄⠀⡏⠀⠀⠀⢷⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠛⠉⣿⣿⣿⣷⠀⢳⠀⠀⠀⠀⠀⠀⠀⣠⡴⠋⠀⠀⠸⣇⡀⠀⠀⡎
⠀⠀⢵⢀⡇⠀⠀⠀⠈⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠛⠁⠀⠀⠀⢸⣿⣿⣿⣧⠈⣇⠀⠀⠀⠀⠀⣰⠋⠀⠀⠀⠀⠀⠀⠙⠒⠚⠁
⠀⠀⠈⢹⠁⠀⠀⠀⠀⠈⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠛⠁⠀⠀⠀⠀⠀⠀⠈⣿⣿⣿⣿⠀⢻⠀⠀⠀⠀⠀⣿⠀⠀⣴⠛⠉⠛⠉⠳⣄⠀⠀
⠀⠀⠀⠸⡄⠀⠀⠀⠀⠀⠈⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠟⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⣿⣿⡇⢸⠀⠀⠀⠀⠀⠸⢆⣀⡿⠀⠀⠀⠀⠀⢈⡇⠀
⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⢀⡎⢻⡿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⡇⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⡆⠀
⠀⠀⠀⢀⣿⡀⠀⠀⠀⠀⠈⠃⠀⣿⣾⣿⣿⣿⣯⣿⠟⠁⠀⣴⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⠁⣾⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠻⡄
⠀⠀⡶⠋⠘⢧⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠙⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⣿⣿⡇⢠⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡰⠃
⠀⠀⢦⠀⠀⠈⢷⣀⠀⠀⠀⢠⣾⣿⣿⣿⣿⣿⣿⣿⣧⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣾⣿⣿⣿⠟⢀⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣀⡼⠁⠀
⠀⠀⢸⡄⠀⠀⠀⠙⣷⣶⢾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣿⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⡿⠛⠛⠁⢠⡾⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡾⠋⠈⠉⠀⠀⠀
⠀⠀⠀⠈⠉⠻⡄⠀⣿⢉⡷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣦⣤⣄⣠⣤⣴⣶⣿⣿⠟⠄⠀⠀⣰⠏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⠁⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢸⠀⠻⠞⠀⠘⢿⣍⠛⠻⠿⠿⣿⣿⣿⣿⣿⠿⢿⡛⠋⣿⣿⣿⣿⠿⠋⠁⠀⠀⣠⠞⠁⠀⠀⠀⠀⠀⠀⠀⣠⡴⠛⠒⠒⠚⠁⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠸⡄⠀⠀⢀⣀⡈⠻⣷⣦⡀⠀⠀⠀⠀⠀⠀⠀⣀⣷⣴⣿⡿⠋⠀⠀⠀⢀⡤⠞⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⠓⠒⠋⠈⠉⠢⡌⠙⠿⢿⣗⣲⠶⠶⠶⠿⠿⠿⠟⠛⢁⣀⣤⠶⠚⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣇⠀⣀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⠀⠀⠈⠉⠉⠛⠛⠒⠒⠛⠛⠉⠉⠁⠀⠀⠀⠀⣀⣀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡀⢼⡟⠁⠈⢻⠄⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣇⠀⠀⠀⠀⠀⠀⠀⠀⢰⡶⠶⢦⠀⠀⠀⠀⠀⠀⣸⠇⠀⠙⡇⠀⠀⠀⠀⣴⠞⠁⡀⠀⠹⠤⠴⠊⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠙⠲⢄⠀⠀⠀⠀⠀⠈⢳⠀⠰⣤⣀⣠⣀⡠⠞⠁⠀⠀⠀⠙⠲⢤⣀⡴⠋⠀⠸⣍⡷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠑⣤⠤⠖⠒⠲⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀]]
return {
    name = "KVStore",
    version = "0.1.0",
    description = "A simple Key-Value store library and server",
    compiler = "cc",
    flags = "-fPIC -O3",
    generateCompileCommands = true,
    modules = {
        {
            name = "Dynamic libmapper",
            sources = {
                "src/mapper.c",
            },
            include = { "include/" },
            output = "build/libmapper",
        },
        {
            name = "Static libmapper",
            version = "0.1.0",
            sources = {
                "src/mapper.c",
            },
            include = { "include/" },
            static = true,
            output = "build/libmapper",
        },
        {
            name = "C++ Server",
            version = "0.1.0",
            compiler = "g++",
            flags = "-std=c++17 -g",
            sources = {
                "src/server.cpp",
            },
            include = {
                "include/",
            },
            libraries = {
                "mapper",
            },
            static = true,
            output = "build/server",
            executable = true,
        },
        {
            name = "C++ Client Lib",
            version = "0.1.0",
            compiler = "g++",
            flags = "-std=c++17",
            sources = {
                "src/client.cpp",
            },
            include = {
                "include/",
            },
            static = true,
            output = "build/libkvclient",
        },
        {
            name = "Rust Server",
            version = "0.1.0",
            sources = {
                "src/server.rs",
            },
            preBuildCommands = function() return true end,
            buildCommands = function(runCmd)
                return runCmd(
                "rustc -C target-feature=+crt-static src/server.rs -o build/rust-server -L build/ -l static=mapper")
            end,
            output = "build/rust-server",
            executable = true,
        },
        {
            name = "Mapper test",
            version = "0.1.0",
            flags = "-DTEST",
            output = "build/mapperTest",
            sources = {
                "src/mapper.c",
            },
            include = { "include/" },
            static = true,
            executable = true,
        },
        {
            name = "C++ client test",
            version = "0.1.0",
            compiler = "g++",
            flags = "-std=c++17 -DTEST",
            output = "build/clientTest",
            sources = {
                "src/client.cpp",
            },
            include = { "include/" },
            static = true,
            executable = true,
        },
        {
            name = "C++ client benchmark",
            version = "0.1.0",
            compiler = "g++",
            flags = "-std=c++17 -DTEST -DBENCHMARK",
            output = "build/benchmark",
            sources = {
                "src/client.cpp",
            },
            include = { "include/" },
            static = true,
            executable = true,
        },
        {
            name = "C Wrapper",
            compiler = "gcc",
            flags = "-fPIC -O3",
            sources = {
                "src/mapper.c",
                "src/jni_wrapper.c",
            },
            include = {
                "include/",
                "/usr/lib/jvm/java-17-openjdk/include",
                "/usr/lib/jvm/java-17-openjdk/include/linux" },
            output = "build/libmapperjni",
            static = false,
        },
        {
            name = "Java part build and run",
            sources = {
                "src/MapperWrapper.java",
                "src/Main.java",
            },
            preBuildCommands = function(runCmd)
                return runCmd("javac -d ./build/classes src/MapperWrapper.java src/Main.java")
            end,
            buildCommands = function(runCmd)
                runCmd("cp -r META-INF/ build/")
                runCmd("cp build/libmapperjni.so build/classes/")
                return runCmd("jar cfm build/Main.jar build/META-INF/MANIFEST.MF -C build/classes .")
            end,
            output = "build/Main.jar",
            executable = true,
        },

    },
}
